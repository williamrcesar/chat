<% content_for :title, "Solicitações de Contato" %>

<div class="flex h-screen bg-[#111b21]" data-controller="presence">

  <%# Sidebar (reuse same structure) %>
  <div class="w-[400px] min-w-[400px] flex flex-col border-r border-[#2a3942] bg-[#111b21]">
    <div class="flex items-center gap-3 px-4 py-3 bg-[#202c33]">
      <%= link_to root_path, class: "p-2 rounded-full hover:bg-[#2a3942] transition-colors" do %>
        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 text-[#aebac1]" fill="none" viewBox="0 0 24 24" stroke="currentColor">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7" />
        </svg>
      <% end %>
      <h1 class="text-white font-semibold text-base">Solicitações de contato</h1>
    </div>

    <div class="flex-1 overflow-y-auto">
      <% if @pending_requests.empty? %>
        <div class="flex flex-col items-center justify-center h-64 text-[#8696a0] text-sm px-8 text-center">
          <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mb-4 opacity-30" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0" />
          </svg>
          <p>Nenhuma solicitação pendente.</p>
        </div>
      <% end %>

      <% @pending_requests.each do |req| %>
        <div class="p-4 border-b border-[#2a3942] hover:bg-[#2a3942]/40 transition-colors">
          <div class="flex items-start gap-3">
            <div class="w-12 h-12 rounded-full bg-[#6a7175] flex items-center justify-center text-white font-semibold text-sm flex-shrink-0">
              <%= req.sender.display_name.first.upcase %>
            </div>
            <div class="flex-1 min-w-0">
              <div class="flex items-baseline justify-between">
                <p class="text-white font-medium text-sm"><%= req.sender.display_name %></p>
                <% if req.sender.nickname.present? %>
                  <p class="text-[#8696a0] text-xs">@<%= req.sender.nickname %></p>
                <% end %>
              </div>
              <p class="text-[#8696a0] text-xs mt-0.5"><%= time_ago_in_words(req.created_at) %> atrás</p>

              <%# Message preview %>
              <div class="mt-2 bg-[#1f2c34] rounded-lg px-3 py-2">
                <% case req.preview_type %>
                <% when "image" %>
                  <p class="text-[#8696a0] text-xs italic flex items-center gap-1">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-4 w-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16l4.586-4.586a2 2 0 012.828 0L16 16m-2-2l1.586-1.586a2 2 0 012.828 0L20 14m-6-6h.01M6 20h12a2 2 0 002-2V6a2 2 0 00-2-2H6a2 2 0 00-2 2v12a2 2 0 002 2z" />
                    </svg>
                    Enviou uma imagem
                  </p>
                <% when "template" %>
                  <p class="text-[#d1d7db] text-xs whitespace-pre-wrap"><%= req.preview_text %></p>
                <% else %>
                  <p class="text-[#d1d7db] text-sm">"<%= req.preview_text %>"</p>
                <% end %>
              </div>

              <div class="flex gap-2 mt-3">
                <%= button_to accept_contact_request_path(req), method: :patch,
                      class: "flex-1 bg-[#00a884] hover:bg-[#02966f] text-white text-sm font-semibold py-2 rounded-lg transition-colors" do %>
                  Aceitar
                <% end %>
                <%= button_to block_contact_request_path(req), method: :patch,
                      class: "flex-1 bg-[#2a3942] hover:bg-red-500/20 text-[#8696a0] hover:text-red-400 text-sm font-semibold py-2 rounded-lg transition-colors" do %>
                  Bloquear
                <% end %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  </div>

  <%# Main panel info %>
  <div class="flex-1 flex flex-col items-center justify-center bg-[#222e35]">
    <div class="text-center text-[#8696a0] max-w-sm px-8">
      <svg xmlns="http://www.w3.org/2000/svg" class="h-24 w-24 mx-auto mb-6 opacity-20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0z" />
      </svg>
      <h2 class="text-xl font-light mb-2">Solicitações de Contato</h2>
      <p class="text-sm">Quando alguém tentar falar com você pela primeira vez, você verá a solicitação aqui antes de aceitar ou bloquear.</p>
    </div>
  </div>
</div>
